# Default Deny
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny
  namespace: media
spec:
  podSelector: {}
  policyTypes: [Ingress, Egress]
---
# DNS
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: media
spec:
  podSelector: {}
  policyTypes: [Egress]
  egress:
    - ports:
        - {protocol: UDP, port: 53}
        - {protocol: TCP, port: 53}
---
# Traefik Ingress
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-traefik-ingress
  namespace: media
spec:
  podSelector: {}
  policyTypes: [Ingress]
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
          podSelector:
            matchLabels:
              app.kubernetes.io/name: traefik
---
# NFS
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-nfs-egress
  namespace: media
spec:
  podSelector: {}
  policyTypes: [Egress]
  egress:
    - to:
        - ipBlock: {cidr: 192.168.1.100/32}
      ports:
        - {protocol: TCP, port: 2049}
---
# Intra-namespace
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-intra-namespace
  namespace: media
spec:
  podSelector: {}
  policyTypes: [Ingress, Egress]
  ingress:
    - from: [{podSelector: {}}]
  egress:
    - to: [{podSelector: {}}]
---
# SABnzbd internet
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: sabnzbd-internet
  namespace: media
spec:
  podSelector:
    matchLabels: {app: sabnzbd}
  policyTypes: [Egress]
  egress:
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except: [10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16]
      ports:
        - {protocol: TCP, port: 563}
        - {protocol: TCP, port: 443}
---
# Prowlarr internet
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: prowlarr-internet
  namespace: media
spec:
  podSelector:
    matchLabels: {app: prowlarr}
  policyTypes: [Egress]
  egress:
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except: [10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16]
      ports:
        - {protocol: TCP, port: 443}
        - {protocol: TCP, port: 80}
---
# Overseerr internet
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: overseerr-internet
  namespace: media
spec:
  podSelector:
    matchLabels: {app: overseerr}
  policyTypes: [Egress]
  egress:
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except: [10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16]
      ports:
        - {protocol: TCP, port: 443}
---
# Plex internet (full access for remote streaming)
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: plex-internet
  namespace: media
spec:
  podSelector:
    matchLabels: {app: plex}
  policyTypes: [Ingress, Egress]
  ingress: [{}]
  egress: [{}]
